<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Analysis of sampled-data (continuous/discrete) systems · ControlSystems.jl</title><meta name="title" content="Analysis of sampled-data (continuous/discrete) systems · ControlSystems.jl"/><meta property="og:title" content="Analysis of sampled-data (continuous/discrete) systems · ControlSystems.jl"/><meta property="twitter:title" content="Analysis of sampled-data (continuous/discrete) systems · ControlSystems.jl"/><meta name="description" content="Documentation for ControlSystems.jl."/><meta property="og:description" content="Documentation for ControlSystems.jl."/><meta property="twitter:description" content="Documentation for ControlSystems.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="ControlSystems.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">ControlSystems.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Introductory guide</span><ul><li><a class="tocitem" href="../../man/introduction/">Introduction</a></li><li><a class="tocitem" href="../../man/creating_systems/">Creating Systems</a></li><li><a class="tocitem" href="../../man/numerical/">Performance considerations</a></li><li><a class="tocitem" href="../../man/differences/">Noteworthy differences from other languages</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../example/">Design</a></li><li><a class="tocitem" href="../analysis/">Analysis</a></li><li><a class="tocitem" href="../smith_predictor/">Smith predictor</a></li><li><a class="tocitem" href="../ilc/">Iterative Learning Control (ILC)</a></li><li><a class="tocitem" href="../delay_systems/">Properties of delay systems</a></li><li><a class="tocitem" href="../automatic_differentiation/">Automatic differentiation</a></li><li><a class="tocitem" href="../tuning_from_data/">Tune a controller using experimental data</a></li><li class="is-active"><a class="tocitem" href>Analysis of sampled-data (continuous/discrete) systems</a><ul class="internal"><li><a class="tocitem" href="#Continuous-to-discrete"><span>Continuous to discrete</span></a></li><li><a class="tocitem" href="#Discrete-to-continuous"><span>Discrete to continuous</span></a></li><li><a class="tocitem" href="#Time-domain-simulation"><span>Time-domain simulation</span></a></li><li><a class="tocitem" href="#Caveats"><span>Caveats</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li></ul></li><li><span class="tocitem">Functions</span><ul><li><a class="tocitem" href="../../lib/constructors/">Constructors</a></li><li><a class="tocitem" href="../../lib/analysis/">Analysis</a></li><li><a class="tocitem" href="../../lib/synthesis/">Synthesis</a></li><li><a class="tocitem" href="../../lib/timefreqresponse/">Time and Frequency response</a></li><li><a class="tocitem" href="../../lib/plotting/">Plotting</a></li><li><a class="tocitem" href="../../lib/nonlinear/">Nonlinear</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Analysis of sampled-data (continuous/discrete) systems</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Analysis of sampled-data (continuous/discrete) systems</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaControl/ControlSystems.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaControl/ControlSystems.jl/blob/master/docs/src/examples/zoh.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Analysis-of-sampled-data-systems"><a class="docs-heading-anchor" href="#Analysis-of-sampled-data-systems">Analysis of sampled-data systems</a><a id="Analysis-of-sampled-data-systems-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-of-sampled-data-systems" title="Permalink"></a></h1><p>A sampled-data system contains both continuous-time and discrete-time components, such as a continuous-time plant and a discrete-time controller. In this example, we will look at how to analyze such systems using the ControlSystems.jl package. To learn more about the theory of sampled-data systems, consult the reference mentioned at the end of this page.</p><p>First, we analyze the effect of ZoH sampling in continuous time and compare it to the equivalent discrete-time system</p><p>We will consider a simple second-order system <span>$P$</span>, which we define in continuous time:</p><pre><code class="language-julia hljs">using ControlSystems, Plots
s = tf(&#39;s&#39;)
P = tf(0.1, [1, 0.1, 0.1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">TransferFunction{Continuous, ControlSystemsBase.SisoRational{Float64}}
        0.1
-------------------
1.0s^2 + 0.1s + 0.1

Continuous-time transfer function model</code></pre><h2 id="Continuous-to-discrete"><a class="docs-heading-anchor" href="#Continuous-to-discrete">Continuous to discrete</a><a id="Continuous-to-discrete-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-to-discrete" title="Permalink"></a></h2><p>Next, we discretize this system using the standard <a href="../../lib/constructors/#ControlSystemsBase.c2d"><code>c2d</code></a> function, which uses ZoH sampling by default. We compare the frequency response of the discretized system with the frequency response of the original continuous-time system multiplied by the transfer function of the ZoH operator <sup class="footnote-reference"><a id="citeref-CCS" href="#footnote-CCS">[CCS]</a></sup></p><p class="math-container">\[Z(s) = \dfrac{1 - e^{-T_s s}}{T_s s}\]</p><pre><code class="language-julia hljs">Ts = 1 # Sample interval
Z = (1 - delay(Ts))/(Ts*s) # The transfer function of the ZoH operator
Pd = c2d(P, Ts) # Discrete-time system obtained by ZoH sampling
Pz = P*Z # The continuous-time version of the discrete-time system

wd = exp10.(-2:0.01:log10(2*0.5))
bodeplot(P, wd, lab=&quot;\$P(s)\$&quot;)
bodeplot!(Pz, wd, lab=&quot;\$P(s)Z(s)\$&quot;)
bodeplot!(Pd, wd, lab=&quot;\$P_d(z)\$ (ZoH sampling)&quot;, l=:dash)
vline!([0.5 0.5], l=(:black, :dash), lab=&quot;Nyquist freq.&quot;, legend=:bottomleft)</code></pre><img src="7bcee2d9.svg" alt="Example block output"/><p>The frequency response of <code>Pz</code> <span>$= P(s) Z(s)$</span> matches that of <span>$P_d(z)$</span> exactly, but these two differ from the frequency response of the original <span>$P(s)$</span> due to the ZoH operator.</p><p>The step response of <code>Pz</code> <span>$= P(s) Z(s)$</span> matches the discrete output of <span>$P_d(z)$</span> delayed by half the sample time</p><pre><code class="language-julia hljs">resP = step(P, 12)
resPz = step(Pz, 12)
resPd = step(Pd, 12)
plot([resP, resPz, resPd], lab=[&quot;P&quot; &quot;Pz&quot; &quot;Pd&quot;])

t_shift = resPd.t .+ Ts / 2
plot!(t_shift, resPd.y[:], lab=&quot;Pd shifted&quot;, m=:o, l=:dash)</code></pre><img src="7e4f508f.svg" alt="Example block output"/><p>With a piecewise constant input, even if it&#39;s not a step, we get the same result</p><pre><code class="language-julia hljs">Tf = 20
ufun = (x,t)-&gt;[sin(2pi*floor(t/Ts)*Ts/5)]
resP = lsim(P, ufun, Tf)
resPz = lsim(Pz, ufun, 0:0.01:Tf)
resPd = lsim(Pd, ufun, Tf)
plot([resP, resPz, resPd], lab=[&quot;P&quot; &quot;Pz&quot; &quot;Pd&quot;])

t_shift = resPd.t .+ Ts / 2
plot!(t_shift, resPd.y[:], lab=&quot;Pd shifted&quot;, m=:o)</code></pre><img src="7e006f90.svg" alt="Example block output"/><p>With a <em>continuous</em> input signal, the result is different, after the initial transient, the output of <code>Pz</code> matches that of <code>Pd</code> exactly (try plotting with the plotly() backend and zoom in at the end)</p><pre><code class="language-julia hljs">Tf = 100
ufun = (x,t)-&gt;[sin(2pi*t/5)]
resP = lsim(P, ufun, Tf)
resPz = lsim(Pz, ufun, 0:0.01:Tf)
resPd = lsim(Pd, ufun, Tf)
plot([resP, resPz, resPd], lab=[&quot;P&quot; &quot;Pz&quot; &quot;Pd&quot;]); lens!([Tf-10, Tf], [-0.1, 0.1], inset=(1, bbox(0.4, 0.02, 0.4, 0.3)))</code></pre><img src="4b0c4ad0.svg" alt="Example block output"/><h2 id="Discrete-to-continuous"><a class="docs-heading-anchor" href="#Discrete-to-continuous">Discrete to continuous</a><a id="Discrete-to-continuous-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-to-continuous" title="Permalink"></a></h2><p>Discrete-time systems can be converted to continuous-time systems formulated with delay terms in such a way that the frequency-response of the two systems match exactly, using the substitution <span>$z^{-1} = e^{-sT_s}$</span>. To this end, the function <a href="../../lib/synthesis/#ControlSystemsBase.d2c_exact"><code>d2c_exact</code></a> is used. This is useful when analyzing hybrid systems with both continuous-time and discrete-time components and accurate frequency-domain calculations are required over the entire frequency range up to the Nyquist frequency.</p><p>Below, we compare the frequency response of a discrete-time system with delays to two continuous-time systems, one translated using the exact method and one using the standard <code>d2c</code> method with inverse ZoH sampling. We extend the frequency axis for this example to extend beyond the Nyquist frequency.</p><pre><code class="language-julia hljs">wd = exp10.(LinRange(-2, 1, 200))
Pdc = d2c_exact(ss(Pd))
Pc = d2c(Pd)
bodeplot(Pd, wd, lab=&quot;\$P_d(z)\$&quot;)
bodeplot!(Pdc, wd, lab=&quot;\$P_d(s)\$ (exact translation)&quot;, l=:dash)
bodeplot!(Pc, wd, lab=&quot;\$P_d(s)\$ (inverse ZoH sampling)&quot;)
vline!([0.5 0.5], l=(:black, :dash), lab=&quot;Nyquist freq.&quot;, legend=:bottomleft)</code></pre><img src="b930b869.svg" alt="Example block output"/><p>We see that the translation of the discrete-time system to continuous time using the standard inverse ZoH sampling (<code>d2c(Pd)</code>) is not accurate for frequencies close to and above the Nyquist frequency. The translation using exact method (<code>d2c_exact(Pd)</code>) matches the frequency response of the discrete-time system exactly over the entire frequency axis.</p><h2 id="Time-domain-simulation"><a class="docs-heading-anchor" href="#Time-domain-simulation">Time-domain simulation</a><a id="Time-domain-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Time-domain-simulation" title="Permalink"></a></h2><p>When analyzing hybrid systems, systems with both discrete-time and continuous-time components, it is often useful to simulate the system in time-domain. To assemble the complete hybrid system, we must either</p><ol><li>Convert continuous-time components to discrete time, or</li><li>Convert discrete-time components to continuous time.</li></ol><p>If all inputs to the continuous-time components are piecewise constant, then the first option is the most natural. The ZoH discretization is exact for piece-wise constant inputs. This conversion can be performed using the function <a href="../../lib/constructors/#ControlSystemsBase.c2d"><code>c2d</code></a> with the (default) ZoH sampling method. If some of the inputs to the continuous-time components are continuously varying, then the second option may be used for maximum accuracy. This is particularly useful if the continuous-time inputs contain frequencies higher than the Nyquist frequency, or when the continuous-time plant contains significant dynamics (resonances etc.) at frequencies higher than the Nyquist frequency of the discrete-time part. This conversion can be performed using the function <a href="../../lib/synthesis/#ControlSystemsBase.d2c_exact"><code>d2c_exact</code></a> which has two modes of operation. The default method produces a causal system which can be simulated in the time domain, while the second method produces an acausal system of lower complexity, which is amenable to frequency-domain computations only. Since we are going to simulate in the time domain here, we will use the causal method (default).</p><p>In this example, we will model a continuous-time system <span>$P(s)$</span> with resonances appearing at large frequencies, while the discrete-time control system is operating a significantly lower frequencies.</p><pre><code class="language-julia hljs">A = [0.0    0.0    0.0   1.0     0.0     0.0
   0.0    0.0    0.0   0.0     1.0     0.0
   0.0    0.0    0.0   0.0     0.0     1.0
 -10.0    0.0   10.0  -0.001   0.0     0.001
  -0.0  -10.0   10.0  -0.0    -0.001   0.001
  10.0   10.0  -20.0   0.001   0.001  -0.002]
B = [0, 0, 0, 0.1, 0, 0]
C = [0.0  0.0  0.0  0.0  0.0  1.0]
P = minreal(ss(A,B,C,0))
w = exp10.(LinRange(-2, 2, 1000))
bodeplot(P, w, lab=&quot;\$P(s)\$&quot;, plotphase=false)</code></pre><img src="6b91ed2f.svg" alt="Example block output"/><p>The discrete-time controller <span>$C(z)$</span> is a basic PI controller</p><pre><code class="language-julia hljs">Ts = 1
C = pid(0.01,10; Ts, Tf = 1/100, state_space=true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">StateSpace{Discrete{Int64}, Float64}
A = 
  1.0   0.009900019603999222   0.006273279749068797
  0.0  -0.9603999215840031     0.02509311899627519
 -0.0  -0.03063124877475005   -0.9996079200156832
B = 
 0.003136639874534405
 0.01254655949813762
 0.00019603999215840032
C = 
 0.3125  0.03248443932562243  0.020584199176632033
D = 
 0.010292099588316016

Sample Time: 1 (seconds)
Discrete-time state-space model</code></pre><p>If we choose option 1, we get a discretized plant that has a very poor frequency-response fit to the original continuous-time plant, making frequency-domain analysis difficult</p><pre><code class="language-julia hljs">Pd = c2d(P, Ts)
Ld = Pd*C
wd = exp10.(-3:0.001:log10(1000*0.05))
figb = bodeplot(P, wd, lab=&quot;\$P(s)\$&quot;)
bodeplot!(Pd, wd, lab=&quot;\$P(z)\$ ZoH&quot;)
bodeplot!(Ld, wd, lab=&quot;\$P(z)C(z)\$&quot;, legend=:bottomleft)</code></pre><img src="5eaf9dfb.svg" alt="Example block output"/><p>If we instead make use of the second method above, exactly translating the discrete-time controller to continuous time, we can more easily determine that the closed-loop system will be stable by inspecting the Bode plot. Here, we show the Bode plot of <span>$P$</span> and that of the loop-transfer function, including the ZoH operator, <span>$P(s)Z(s)C(s)$</span>.</p><pre><code class="language-julia hljs">Cc = d2c_exact(C)
Lc = P*Z*Cc

bodeplot(P, wd, lab=&quot;\$P(s)\$&quot;)
bodeplot!(Lc, wd, lab=&quot;\$P(s)C(s)\$&quot;, legend=:bottomleft, c=3)</code></pre><img src="67ce0bc5.svg" alt="Example block output"/><p>If we form the closed-loop system from an input disturbance to the output</p><p class="math-container">\[PS = \dfrac{P(s)}{1 + P(s)C(s)}\]</p><p>we can simulate the response to a continuous-time input disturbance that contains frequencies higher than the Nyquist frequency of the discrete-time system, we do this below. We also try doing this with the discretized plant, which yields a very poor result</p><pre><code class="language-julia hljs">PS = feedback(P, Z*Cc)  # Use the continuous-time plant and continuous translation of the controller + ZoH operator
PSd = feedback(Pd, C) # Use the discretized plant and discrete controller
ω = 5.53 # Frequency of input disturbance (rad/s) (Nyquist frequency is π rad/s)
disturbance(x, t) = sin(ω*t) # Continuous input disturbance
plot(lsim(PS, disturbance, 0:0.22:3500), lab=&quot;Continuous disturbance response&quot;)
plot!(lsim(PSd, disturbance, 3500), lab=&quot;Discrete disturbance response&quot;)
hline!([abs(freqresp(PS, ω)[])], l=(:black, :dash), lab=&quot;Predicted freq. response amplitude&quot;, legend=:bottomleft, fmt=:png)</code></pre><img src="599965aa.svg" alt="Example block output"/><p>The continuous-time analysis eventually settles at a periodic output that matches the amplitude predicted by the continuous-time frequency response. However, the discrete-time simulation yields, as expected, a very poor result. Noticeable in the simulation is the appearance of a beat frequency, which is expected due to the modulation introduced by sampling. <sup class="footnote-reference"><a id="citeref-CCS" href="#footnote-CCS">[CCS]</a></sup></p><h2 id="Caveats"><a class="docs-heading-anchor" href="#Caveats">Caveats</a><a id="Caveats-1"></a><a class="docs-heading-anchor-permalink" href="#Caveats" title="Permalink"></a></h2><ul><li>The exact output of the system that was translated from discrete to continuous time is not going to be accurate, so transient properties of the hybrid system cannot be accurately assessed using this kind of analysis. </li><li>Interpretation of frequency-responses for sampled-data systems must be done with care. The modulation introduced by sampling implies the creating of additional frequencies in the output. For an input with frequency <span>$\omega$</span>, the output will contain all frequencies <span>$\omega ± \omega_s k$</span> where <span>$\omega_s$</span> is the sampling frequency and <span>$k$</span> is an integer. <sup class="footnote-reference"><a id="citeref-CCS" href="#footnote-CCS">[CCS]</a></sup></li></ul><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p>Learn more about sampled-data systems and zero-order hold sampling in chapter 7 of the reference below.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-CCS"><a class="tag is-link" href="#citeref-CCS">CCS</a>Åström, K. J., &amp; Wittenmark, B. (1997). Computer-Controlled Systems: Theory and Design.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tuning_from_data/">« Tune a controller using experimental data</a><a class="docs-footer-nextpage" href="../../lib/constructors/">Constructors »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 14 November 2024 08:58">Thursday 14 November 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
